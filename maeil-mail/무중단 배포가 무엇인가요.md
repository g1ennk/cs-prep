# 무중단 배포가 무엇인가요

## 요약

- 무장단 배포는 서비스에 다운 타임이 발생하지 않으면서, 새로운 버전의 애플리케이션을 서버에 배포하는 것을 의미합니다.
- 대표적인 무중단 배포
    - 롤링 배포
        - 서버를 한 대씩 순차적으로 업데이트하는 가장 기본적인 방식
        - 하위호환성
        - 새로운 서버 증성하지 않음
    - 블루/그린 배포
        - 기존의 서버와 동일한 스펙의 서버를 준비하고, 신규 버전을 배포한 후 기존 서버는 폐기하고 트래픽을 시규 버전의 서버로 이전시키는 방법
        - 폐기 이전에는 빠른 롤백 가능
        - 배포 과정에서 미리 새로운 서버를 준비하기 때문에 비용 발생
    - 카나리 배포
        - 기존 서버와 새로운 버전의 서버를 구성한 후 전체 트래픽을 퍼센티지로 관리하는 방법
        - 롤링 배포와 마찬가지로 두 버전의 서버가 공존하기 때문에 하위호환성 신경 써야 함
- 상황에 따른 배포 전략
    - 일반적인 상황 -> 롤링 배포
    - 대규모 업데이트 -> 비용 감수하고 블루/그린
    - 통계적으로 확인 상황 or A/B 테스트 -> 카나리 배포

### 1. 정의

- 무중단 배포란 서비스를 배포하는 동안에도 사용자에게 중단(다운타임) 없이 지속적으로 서비스를 제공할 수 있도록 하는 배포 방식

### 2. 왜 필요한가?

- 일반적인 배포에서는 새로운 버전이 올라가는 동안 기존 서버를 중지시키므로 사용자가 잠시 동안 서비스 이용일 불가능하다.
- 하지만 트래픽이 많은 서비스나 운영 중인 프로덕션 환경에서는 1초의 다운타임이 사용자 이탈과 매출 손실로 이어질 수 있다.
- 즉, 서비스 가용성을 높이기 위해 무중단 배포 전략을 적용한다.

### 3. 동작 원리

- 무중단 배포는 기본적으로 두 개 이상의 서버를 활용하여 기존 서버는 트래픽을 계속 처리하고, 새 버전에 서버가 올라간 후 정상이라면 트래픽을 전환한다.

### 4. 대표적인 무중단 배포 방식

| 방식                    | 설명                                        | 특징               |
|-----------------------|-------------------------------------------|------------------|
| Rolling Update        | 여러 인스턴스 중 일부씩 순차적으로 새 버전으로 교체             | 점진적, 리스크 낮음      |
| Blue-Green Deployment | 두 개의 동일한 환경(Blue=현재, Green=새 버전) 중 하나를 전환 | 빠른 롤백, 리소스 2배 필요 |
| Canary Deployment     | 전체 중 일부 사용자만 새 버전으로 먼저 전환 (테스트 후 점진 확대)   | 트래픽 기반 검증 가능     |

### 5. 장단점

| 장점                                              | 단점                                                         |
|-------------------------------------------------|------------------------------------------------------------|
| - 다운타임 없이 배포 가능<br>- 사용자 경험 손상 없음<br>- 빠른 롤백 가능 | - 인프라 리소스 2배 필요<br>- 배포 구조 복잡도 증가<br>- 자동화 설정 필요 (CI/CD 등) |

### 6. 무중단 배포 선택 기준

| 구분             | **Rolling Update**                                            | **Blue-Green Deployment**                                                   | **Canary Deployment**                                        |
|----------------|---------------------------------------------------------------|-----------------------------------------------------------------------------|--------------------------------------------------------------|
| **핵심 개념**      | 서버를 순차적으로 교체                                                  | 두 개의 동일한 환경을 준비해 트래픽 전환                                                     | 일부 사용자에게만 새 버전 노출                                            |
| **작동 방식**      | 기존 서버를 하나씩 내려 새 버전으로 교체하면서 점진 배포                              | Blue(운영) 환경은 유지, Green(신버전)에 배포 후 트래픽 스위칭                                   | 일정 비율(예: 5%, 20%, 50%)로 새 버전에 트래픽 점진 전환                      |
| **장점**         | - 리소스 추가 필요 없음<br>- 점진적 교체로 안정적<br>- 롤백 비교적 쉬움                | - 완전한 격리 환경<br>- 롤백 즉시 가능<br>- 트래픽 스위칭으로 빠른 전환                              | - 실사용자 기반 검증 가능<br>- 실험적 기능 점진 배포<br>- 리스크 최소화               |
| **단점**         | - 구버전/신버전 공존 중 일시적 비정상 가능<br>- DB 스키마 변경 시 주의 필요              | - 환경 2세트 필요 (비용↑)<br>- 전환 순간 트래픽 급변 가능                                      | - 트래픽 관리 로직 필요<br>- 구현 복잡도 높음 (관찰·모니터링 필수)                   |
| **적합한 상황**     | - 트래픽이 많지 않고<br>점진적 배포가 가능할 때<br>- 컨테이너 환경 (K8s, Docker)      | - 즉시 롤백이 중요한 미션 크리티컬 서비스<br>- 대규모 트래픽 / 인프라 여유 있을 때                         | - 신기능 실험, 베타 테스트<br>- 사용자가 많고 리스크 최소화가 필요할 때                 |
| **대표 기술 / 도구** | Kubernetes RollingUpdate<br>PM2 reload<br>Spring Cloud Deploy | AWS CodeDeploy Blue/Green<br>GCP MIG Template Switch<br>NGINX Dual Upstream | Argo Rollouts, Flagger<br>Kubernetes Canary<br>Envoy + Istio |
| **롤백 난이도**     | 중간 (이전 버전 재배포 필요)                                             | 쉬움 (트래픽만 다시 스위칭)                                                            | 쉬움 (트래픽 비율만 원복)                                              |

## 발화

무중단 배포는 서비스 중단 즉 다운타임 업이 새로운 버전의 애플리케이션울 배포하는 방식입니다.

즉, 일반적으로 기존 서버의 애플리케이션을 잠시 중단시켜 업데이트하는 것이 아닌, 두 개 이상의 서버를 두고 새 서버가 정상 동작이 확인되면 트래픽을 전화하는 방식입니다.

대표적으로 여러 서버를 두고 한 대의 서버씩 순차적으로 업데이트하는 방식인 롤링 배포,
두 개의 동일한 서버 환경을 세팅한 후 새 버전으로 트래픽을 전환하는 방식인 블루 그린 배포,
서버 구성을 퍼센테이지로 관리하여 전체 서버 중 일부만 새버전으로 전환하여 점진적으로 확대하는 방식인 카나리 배포가 존재합니다.

따라서 리소스가 제한되고 단순한 배포가 목적일 땐 롤링 배포를,
안정성과 롤백 속도가 최우선이라면 블루그린을,
새 기능을 실사용자에게 점진적으로 노출하고 싶을 땐 카나리 배포를 선택합니다.

중요한 건 정답이 없기 때문에 각 배포 방식의 특징과 장단점을 제대로 파악하여 서비스에 맞는 배포 방식을 선택해야 합니다.
