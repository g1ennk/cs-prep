# Gracefult Shutdown의 필요성에 대해서 설명해주세요

## 요약

### 1. 정의

- 우아한 종료(Graceful Shutdown)란 애플리케이션이 종료될 때 바로 종료되는 것이 아니라 현재 처리하고 있는 작업을 마무리하고 리소스를 정리한 이후 종료하는 방식을 의미합니다.
- 서버 애플리케이션에선 해당 신호를 받았을 때, 새로운 요청은 차단하고 기존 처리 중인 요청을 모두 완료한 후에 프로세스를 종료합니다.
- 단순히 강제 종료가 아닌, 요청 처리 중단 -> 정리 -> 종료 단계를 거쳐 안전하게 셧다운하는 방식을 의미합니다.
- 프로세스 종료 시그널 두 가지
    - SIGTERM: 종료 이전에 수행되어야 하는 절차들을 안전하게 수행할 수 있는 신호
    - SIGKILL: 프로세스를 강제 종료하는 신호
- 스프링 환경에서 우아한 종료
    - 스프링에선 Graceful Shutdown 설정을 지원해줌.
    - 단, 타임아웃 설정을 통해 데드락이나 무한 루프 발생을 방지해야함.

### 2. 필요성

- 요청 손실 방지
    - 서버가 강제 종료되면, 처리 중이던 HTTP 요청이나 DB 트랜잭션이 중단되어 데이터 손실이 발생할 수 있다.
    - 우아한 종료로 현재 처리 중인 요청을 모두 완료한 후에 안전하게 종료할 수 있다.
- 서비스 무중단 배포
    - 배포 시 기존 서버를 내리고 새 서버를 띄우는 과정에서 요청이 끊길 수 있음
    - 우아한 종료를 적용하면, 로드밸런서를 통해 트래픽을 새 인스턴스로 우선 이동시키고, 기존 인스턴스의 남은 요청을 모두 처리한 뒤 종료하여 무중단 배포가 가능함.
- 자원 정리 및 안정성 확보
    - 셧다운 시 DB 연결, 스레드 풀과 같은 자원 누수를 방지하기 위해 명시적으로 종료를 해줘야함.

### 3. 실제 동작 방식 (스프링 부트)

Spring Boot에선 `SIGTERM` 신호를 받으면 아래와 같은 순서로 Graceful Shutdown이 진행됨

1. 로드밸런서에서 트래픽 분리
2. 현재 요청 처리 완료 대기
3. 자원 해제
4. 컨텍스트 종료

## 발화

Graceful Shutdown은 서버를 안전하게 종료하기 위한 메커니즘으로, 종료 시점에 처리 중인 요청이 중단되지 않도록 보장하는 과정입니다.

이를 통해 요청 손실이나 서비스 무중단 배포 그리고 자원 정리를 통해 안정성을 확보할 수 있습니다.

특히 Spring Boot에서는 `server.shutdown=graceful`이라는 설정을 통해 손쉽게 구현할 수 있습니다.

## 추가 학습 자료

https://www.maeil-mail.kr/question/190